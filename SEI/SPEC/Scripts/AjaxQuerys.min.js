var AjaxConsult=function()
{
    var NameTable, dprFromItem, dprToItem, dllServidor, dllDependencia, dllPuesto, dllResponsabilidad;
    var IsRequest = false;

    var a=function(IdControl, ReloadTable)
    {
        if (IsRequest === false)
        {
            IsRequest = true;
            if (document.getElementById("DependenciaId") && (IdControl === "dpRange"))
            {
                $("#DependenciaId").select2("val", "");
            }
            if (document.getElementById("PuestoId") && ((IdControl === "dpRange") ||  (IdControl === "DependenciaId")))
            {
                $("#PuestoId").select2("val", "");
            }
            if (document.getElementById("ServidorId") && ((IdControl === "dpRange") || (IdControl === "DependenciaId") || (IdControl === "PuestoId")))
            { 
                $("#ServidorId").select2("val", "");
            }

            App.blockUI({target:"#Entradas_Portlet",boxed:!0,message:"Procesando…"});
            NameTable = "Servidores";
            
            dprFromItem = $("#dprFrom").val();
            dprToItem = $("#dprTo").val();
            dllServidor = null;
            dllPuesto = null;
            dllDependencia = null;
            b("Initialize", IdControl, ReloadTable);
        }
    },
        b = function (Command, IdControl, ReloadTable)
    {
        switch(Command) {
            case "Initialize":
                if (document.getElementById("DependenciaId") && ((IdControl === "dpRange")))
                {
                   
                    c("GetDependencia", $("#DependenciaId"), IdControl, ReloadTable); 
                    
                    
                }
                else
                {
                    b("GetDependencia", IdControl, ReloadTable);
                }
                break;
            case "GetDependencia":
                dllDependencia = document.getElementById("DependenciaId") ? $("#DependenciaId").val() : null;
                if (document.getElementById("PuestoId") && ((IdControl === "dpRange") || (IdControl === "DependenciaId")))
                {
                    c("GetPuesto", $("#PuestoId"), IdControl, ReloadTable);
                }
                else
                {
                    b("GetPuesto", IdControl, ReloadTable);
                }
                break;
            case "GetPuesto":
                dllPuesto = document.getElementById("PuestoId") ? $("#PuestoId").val() : null;
               
                if (document.getElementById("ServidorId") && ((IdControl === "dpRange") || (IdControl === "DependenciaId") || (IdControl === "PuestoId"))) {
                    c("GetServidor", $("#ServidorId"), IdControl, ReloadTable);
                }
                else {
                    b("GetServidor", IdControl, ReloadTable);
                }
                break;
            case "GetServidor":
                dllServidor = document.getElementById("ServidorId") ? $("#ServidorId").val() : null;
                var DataColums = [{ data: "fecha" }, { data: "ejercicio" }, { data: "ramo" }, { data: "dependencia" },  { data: "nombre" }, { data: "puesto" }, { data: "responsabilidad" }, { data: "tipo" }];
                d("GetTabla", $("#TableEntradas"), DataColums, 7);
          

                break;
            default:
                App.unblockUI("#Entradas_Portlet");
                IsRequest = false;
                break;
        }
    },
        c = function (Command, Control, IdControl, ReloadTable)
    {
        
        $.ajax({
                cache: false,
                type: "POST",
            url: "https://pdncoah-6npsxhllvq-wl.a.run.app/Home/" + Command + "?NombreTabla=" + NameTable + "&FechaIni=" + dprFromItem + "&FechaFin=" + dprToItem + "&Dependencia=" + dllDependencia + "&Puesto=" + dllPuesto + "&Servidor=" + dllServidor,
            //data: JSON.stringify({ "NombreTabla": NameTable, "FechaIni": dprFromItem, "FechaFin": dprToItem, "Dependencia": dllDependencia, "Puesto": dllPuesto, "Servidor": dllServidor }),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function(response)

            // Aqui me da las respuestas de los seleccionables de búsqueda
            {
                console.log("https://pdncoah-6npsxhllvq-wl.a.run.app/Home/" + Command + "?NombreTabla=" + NameTable + "&FechaIni=" + dprFromItem + "&FechaFin=" + dprToItem + "&Dependencia=" + dllDependencia + "&Puesto=" + dllPuesto + "&Servidor=" + dllServidor,)
                console.log(response)
                Control.html('');
                Control.append($('<option></option>').val("").html("Select"));
                $.each(response, function (id, option) {
                    Control.append($('<option></option>').val(option.id).html(option.name));
                });
                b(Command, IdControl, ReloadTable);
            },
            failure: function (response) {
                b(Command, IdControl, ReloadTable);
            }
        });
        },
    d=function(Command, Control, DataColumns, NumColumn)
    {
        if ($(window).width() <= 1199) {
            resp = 0;
            domin = "<'top'lf>rt<'bottom'ip><'clear'>";
            $("#Contenedor").css('top', '0px');
             
        } else {
            resp = 1;
            domin = "<'top'lf>rt<'bottom'ip><'clear'>";
           

        };
        Control.DataTable().destroy();
        Control.DataTable({
            drawCallback: function(settings) {
                if(settings.jqXHR !== null)
                {
                    
                    b(Command);
                }
            },
            ajax:
            {
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "https://pdncoah-6npsxhllvq-wl.a.run.app/Home/" + Command + "?NombreTabla=" + NameTable + "&FechaIni=" + dprFromItem + "&FechaFin=" + dprToItem + "&Dependencia=" + dllDependencia + "&Puesto=" + dllPuesto + "&Servidor=" + dllServidor,
                dataSrc: "",
                dataType: "json",
               
                data: function (data) {
                   return JSON.stringify({ "NombreTabla": NameTable, "FechaIni": dprFromItem, "FechaFin": dprToItem, "Dependencia": dllDependencia, "Puesto": dllPuesto, "Servidor": dllServidor});
                   console.log('"https://pdncoah-6npsxhllvq-wl.a.run.app/Home/" + Command + "?NombreTabla=" + NameTable + "&FechaIni=" + dprFromItem + "&FechaFin=" + dprToItem + "&Dependencia=" + dllDependencia + "&Puesto=" + dllPuesto + "&Servidor=" + dllServidor, dataSrc: "", dataType: "json",')
                }
            },
            columns: DataColumns,
            dom: domin,
            language:
            {
                aria:
                {
                    sortAscending:": activar para ordenar la columna ascendente",
                    sortDescending:": activar para ordenar la columna descendente"
                },
                emptyTable:"No hay datos disponibles en la tabla",
                info:"Resultado: _START_ al _END_ de _TOTAL_ entradas",
                infoEmpty:"Entradas no encontradas",
                infoFiltered:"(filtrada de _MAX_ entradas totales)",
                lengthMenu: "_MENU_",
                search:"Buscar:",
                zeroRecords:"No se encontraron registros coincidentes",
                paginate: 
                {
                    previous:"Anterior",
                    next:"Siguiente",
                    last:"Último",
                    first:"Primero"
                }
            },
            footerCallback:function(e,t,a,r,o)
            {
                var n=this.api(),
                c=function(e)
                {
                    return"string"===typeof e?1*e.replace(/[\$,]/g,""):"number"===typeof e?e:0
                };
                total=n.column(NumColumn).data().reduce(function(e,t){return c(e)+c(t)},0),
                $(n.column(NumColumn).footer()).html(total)
            },
            buttons:[
            {extend:"print",className:"btn dark btn-outline"},
            {extend:"copy",className:"btn red btn-outline"},
            {extend: "pdf", className: "btn green btn-outline", orientation: 'landscape', customize: function (doc) {}},
            {extend:"excel",className:"btn yellow btn-outline "},
            {extend:"csv",className:"btn purple btn-outline "},
            {text:"Reload",className:"btn default",action:function(e,t,a,n){alert("Custom Button")}}],
            pagingType: "numbers",
            responsive: !resp,
            order:[[0,"asc"]],
            lengthMenu:[[10,25,50,100,-1],[10,25,50,100,"Todo"]],
            pageLength:10
        });
        $("#TableEntradas_tools > li > a.tool-action").unbind('click').bind("click",function(){
            var e=$(this).attr("data-action");
            Control.DataTable().button(e).trigger()
        });
    },
    Funct=function()
    {
        $(".ReloadDataTable").change(function (){
            a(this.id,1);
        });
        $(".ReloadDataTableB").click(function () {
            a(this.id, 1);
        });

        $(".ReloadFilter").change(function () {
            a(this.id,0);
        });
    };
    return{init:function(){a("dpRange",1),Funct()}}
}();

App.isAngularJsApp() === !1 && jQuery(document).ready(function () { AjaxConsult.init() });;
























